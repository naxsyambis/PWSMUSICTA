<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Friska Music</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/admin.css">
    <style>
        /* Mencegah Flicker */
        #adminDashboard, #loginForm { display: none; }
        body { font-family: 'Poppins', sans-serif; background-color: #FDF6E3; color: #433422; }
        
        /* Utility tambahan untuk tabel modern */
        .user-table { width: 100%; border-spacing: 0 10px; border-collapse: separate; }
        .user-row { background: white; transition: transform 0.2s; }
        .user-row:hover { transform: scale(1.005); }
        .user-row td { padding: 15px 20px; }
        .user-row td:first-child { border-radius: 15px 0 0 15px; }
        .user-row td:last-child { border-radius: 0 15px 15px 0; }
        
        /* Tombol Aksi */
        .btn-edit { background: #FFF9E7; color: #FFC107; padding: 6px 12px; border-radius: 8px; font-weight: 600; font-size: 0.8rem; }
        .btn-delete { background: #FFF0F0; color: #FF4D4D; padding: 6px 12px; border-radius: 8px; font-weight: 600; font-size: 0.8rem; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="loginForm" class="flex items-center justify-center min-h-[80vh]">
        <div class="bg-white p-8 rounded-[30px] shadow-xl w-full max-w-md border border-orange-100 text-center">
            <div class="mb-8">
                <h1 class="text-3xl font-bold tracking-widest text-[#433422]">Music</h1>
                <p class="text-xs uppercase tracking-[0.3em] text-[#E9A05B]">admin panel</p>
            </div>
            
            <h2 class="text-xl font-semibold mb-6">Restricted Access</h2>
            
            <div class="space-y-4 text-left">
                <div>
                    <label class="text-xs font-bold text-gray-400 uppercase ml-2">Email Admin</label>
                    <input id="email" type="email" placeholder="admin@music.com" 
                        class="w-full bg-gray-50 border border-gray-100 p-3 rounded-2xl focus:outline-none focus:border-orange-400 transition">
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-400 uppercase ml-2">Password</label>
                    <input id="password" type="password" placeholder="••••••••" 
                        class="w-full bg-gray-50 border border-gray-100 p-3 rounded-2xl focus:outline-none focus:border-orange-400 transition">
                </div>
                <button onclick="adminLogin()" 
                    class="w-full bg-[#433422] text-white p-4 rounded-2xl font-bold hover:bg-black transition shadow-lg mt-4">
                    Sign In to Dashboard
                </button>
                <button onclick="handleLogin()" 
                    class="w-full bg-[#433422] text-white p-4 rounded-2xl font-bold hover:bg-black transition shadow-lg mt-4">
                    Back to Login
                </button>
            </div>
        </div>
    </div>

    <div id="adminDashboard" class="max-w-5xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-center mb-10 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-[#433422]">Dashboard</h1>
                <p class="text-orange-500 text-sm font-medium">Manajemen Data Client & Member</p>
            </div>
            <div class="flex items-center gap-4 bg-white p-2 pr-6 rounded-full shadow-sm border border-orange-50">
                <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center text-orange-600 font-bold">A</div>
                <span id="adminEmailDisplay" class="text-sm font-semibold opacity-70"></span>
                <button onclick="handleLogout()" class="text-xs font-bold text-red-400 hover:text-red-600 uppercase tracking-wider ml-2">Logout</button>
            </div>
        </div>

        <div class="bg-[#433422] text-white p-8 rounded-[30px] shadow-2xl mb-12 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-orange-500 opacity-10 rounded-full -mr-16 -mt-16"></div>
            
            <h3 id="formTitle" class="text-xl font-semibold mb-6 flex items-center gap-3">
                <span class="w-2 h-6 bg-orange-400 rounded-full"></span> 
                Tambah User Baru
            </h3>
            <input type="hidden" id="editUserId"> 
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="flex flex-col gap-2">
                    <label class="text-[10px] uppercase tracking-widest opacity-50 ml-1">Username</label>
                    <input type="text" id="username" placeholder="Nama User" class="bg-white/5 border border-white/10 p-3 rounded-xl focus:bg-white/10 outline-none transition">
                </div>
                <div class="flex flex-col gap-2">
                    <label class="text-[10px] uppercase tracking-widest opacity-50 ml-1">Email Address</label>
                    <input type="email" id="userEmail" placeholder="user@email.com" class="bg-white/5 border border-white/10 p-3 rounded-xl focus:bg-white/10 outline-none transition">
                </div>
                <div class="flex flex-col gap-2">
                    <label class="text-[10px] uppercase tracking-widest opacity-50 ml-1">Password</label>
                    <input type="password" id="userPassword" placeholder="••••••••" class="bg-white/5 border border-white/10 p-3 rounded-xl focus:bg-white/10 outline-none transition">
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <button id="btnSave" onclick="saveUser()" class="bg-[#E9A05B] text-white px-10 py-3 rounded-xl font-bold hover:bg-[#d48b43] transition shadow-lg">Simpan User</button>
                <button id="btnCancel" onclick="resetForm()" class="hidden bg-white/10 text-white px-8 py-3 rounded-xl font-bold hover:bg-white/20 transition">Batal</button>
                <p id="formMessage" class="text-xs text-orange-200"></p>
            </div>
        </div>

        <div class="mb-4 flex items-center justify-between">
            <h4 class="text-xs font-bold uppercase tracking-[0.2em] text-gray-400">Daftar Pengguna Aktif</h4>
            <span class="text-[10px] bg-orange-100 text-orange-600 px-3 py-1 rounded-full font-bold">TOTAL DATA: <span id="userCount">0</span></span>
        </div>

        <div class="overflow-x-auto">
            <table class="user-table">
                <thead>
                    <tr class="text-left text-[10px] uppercase tracking-widest text-gray-400">
                        <th class="px-5">ID</th>
                        <th>Informasi User</th>
                        <th>Kontak / Email</th>
                        <th>API Key</th>
                        <th class="text-center">Aksi Manajemen</th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                    <tr><td colspan="4" class="text-center py-20 text-gray-400 italic">Memuat data user...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script src="/js/landing.js"></script>
    <script src="/js/admin.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('adminToken');
            const adminEmail = localStorage.getItem('adminEmail');
            const loginForm = document.getElementById('loginForm');
            const adminDashboard = document.getElementById('adminDashboard');
            const displayEmail = document.getElementById('adminEmailDisplay');

            if (token) {
                loginForm.style.display = 'none';
                adminDashboard.style.display = 'block';
                if(displayEmail) displayEmail.innerText = adminEmail || 'Admin';
                
                if (typeof loadUsers === "function") {
                    loadUsers();
                }
            } else {
                // Tampilkan form login jika belum ada token
                loginForm.style.display = 'flex';
                adminDashboard.style.display = 'none';
            }
        });

        // Intercept fungsi render di admin.js (Opsional jika Anda ingin merapikan tampilan baris tabel)
        // Jika admin.js Anda melakukan innerHTML pada tbody, pastikan strukturnya sesuai 
        // dengan class .user-row, .btn-edit, dan .btn-delete yang sudah saya buat di atas.
    </script>
</body>
</html>